const r=[];for(let o=0;o<256;++o)r.push((o+256).toString(16).slice(1));function f(o,n=0){return(r[o[n+0]]+r[o[n+1]]+r[o[n+2]]+r[o[n+3]]+"-"+r[o[n+4]]+r[o[n+5]]+"-"+r[o[n+6]]+r[o[n+7]]+"-"+r[o[n+8]]+r[o[n+9]]+"-"+r[o[n+10]]+r[o[n+11]]+r[o[n+12]]+r[o[n+13]]+r[o[n+14]]+r[o[n+15]]).toLowerCase()}let u;const y=new Uint8Array(16);function w(){if(!u){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");u=crypto.getRandomValues.bind(crypto)}return u(y)}const S=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),m={randomUUID:S};function b(o,n,e){if(m.randomUUID&&!o)return m.randomUUID();o=o||{};const t=o.random??o.rng?.()??w();if(t.length<16)throw new Error("Random bytes length must be >= 16");return t[6]=t[6]&15|64,t[8]=t[8]&63|128,f(t)}const p=["pizza","spaghetti","gelato","caffè","macchina","sole","mare","montagna","libro","musica","arte","cinema","viaggio","amico","famiglia","lavoro","scuola","università","tecnologia","natura","animali","città","campagna","storia","geografia","matematica","scienza","medicina","economia","politica"];function h(o){let n=4294967295;for(let e=0;e<o.length;e++){const t=o.charCodeAt(e);n=n>>>8^v[(n^t)&255]}return(n^4294967295).toString(16).padStart(8,"0")}const v=(()=>{const o=new Array(256);for(let n=0;n<256;n++){let e=n;for(let t=0;t<8;t++)e=e&1?3988292384^e>>>1:e>>>1;o[n]=e}return o})();function g(o){return o.map(n=>n.trim()).filter(n=>n.length>0&&n.length<=24).map(n=>n.toLowerCase()).filter((n,e,t)=>t.indexOf(n)===e)}function d(o){const n=Object.keys(o).sort().reduce((e,t)=>(e[t]=o[t],e),{});return JSON.stringify(n,null,0)}function I(o){return btoa(o).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function U(o){o=o.replace(/-/g,"+").replace(/_/g,"/");const n=o.length%4;return n&&(o+="=".repeat(4-n)),atob(o)}function A(){return p[Math.floor(Math.random()*p.length)]}function C(o,n){return[...o].sort(()=>.5-Math.random()).slice(0,n)}function D(o){const n=[];o.v!==1&&n.push(`Versione non supportata: ${o.v}`),(!Array.isArray(o.giocatori)||o.giocatori.length<3)&&n.push("Deve esserci almeno 3 giocatori"),(!Array.isArray(o.impostori)||o.impostori.length<1)&&n.push("Deve esserci almeno 1 impostore"),o.impostori.length>=o.giocatori.length&&n.push("Troppi impostori rispetto ai giocatori");const e=g(o.giocatori),t=g(o.impostori);for(const i of t)e.includes(i)||n.push(`Impostore "${i}" non presente nella lista giocatori`);return(!o.parola||o.parola.trim().length===0)&&n.push("Parola non valida"),n}function E(o){const n={v:1,id:b(),createdAt:new Date().toISOString(),...o},{sig:e,...t}=n,i=d(t),a=h(i);n.sig=a;const s=d(n);return`IMPO1_${I(s)}`}function O(o){if(!o.startsWith("IMPO1_"))throw new Error("Formato codice non riconosciuto");const n=o.substring(6),e=U(n);let t;try{t=JSON.parse(e)}catch{throw new Error("Codice non valido: formato JSON errato")}const{sig:i,...a}=t,s=d(a),c=h(s);if(i!==c)throw new Error("Codice manomesso o corrotto");const l=D(t);if(l.length>0)throw new Error(`Configurazione non valida: ${l.join(", ")}`);return t}function z(o,n,e){const t=g(o);if(t.length<3)throw new Error("Almeno 3 giocatori sono necessari");if(n<1||n>=t.length)throw new Error("Numero di impostori non valido");const i=C(t,n),a=A(),c=E({name:e||"",giocatori:t,impostori:i,parola:a}),l=O(c);return{code:c,config:l}}export{O as d,z as g};
